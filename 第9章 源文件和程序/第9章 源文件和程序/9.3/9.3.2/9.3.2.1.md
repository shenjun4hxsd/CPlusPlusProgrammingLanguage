##å…¶ä»–è®¡ç®—å™¨æ¨¡å—

&emsp;&emsp;è®¡ç®—å™¨çš„å…¶ä»–æ¨¡å—ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼åˆ†æå™¨çš„æ–¹å¼ç»„ç»‡èµ·æ¥ã€‚ç„¶è€Œï¼Œç”±äºè¿™äº›æ¨¡å—éå¸¸å°ï¼Œå®ƒä»¬å°±æ²¡å¿…è¦å†æœ‰è‡ªå·±çš„ `_impl.h` æ–‡ä»¶ã€‚åªæœ‰åœ¨é€»è¾‘æ¨¡å—ç”±è®¸å¤šå‡½æ•°ç»„æˆï¼Œè€Œå®ƒä»¬åˆéœ€è¦ä¸€ä¸ªå…±äº«ç¯å¢ƒæ—¶ï¼Œæ‰éœ€è¦ä½¿ç”¨è¿™ç§å¤´æ–‡ä»¶ã€‚

&emsp;&emsp;é”™è¯¯å¤„ç†å™¨å·²ç»ç¼©å‡ä¸ºä¸€ç»„å¼‚å¸¸ç±»å‹ï¼Œæ ¹æœ¬ä¸éœ€è¦error.cï¼š

```javascript
    error.h:
    
    namespace Error {
        struct Zero_divide { };
        
        struct Syntax_error {
            const char* p;
            Syntax_error(const char* q) { p = q; }
        };
    }
```

è¯æ³•å¤„ç†å™¨æä¾›çš„æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„è€Œä¸”æ¯”è¾ƒæ±¡æµŠçš„ç•Œé¢ï¼š

```javascript
    // lexer.h:
    
    namespace Lexer {
        enum Token_value {
            NAME,            NUMBER,            END,
            PLUS='+',        MINUS='-',         MUL='*',    DIV='\',
            PRINT=';',       ASSIGN='=',        LP='(',     RP=')'
        };
        
        extern Token_value curr_tok;
        extern double number_value;
        extern std::string string_value;
        
        Token_value get_token();
    }
```

é™¤äº† `lexer.h` å¤–ï¼Œè¯æ³•å¤„ç†å™¨çš„å®ç°è¿˜ä¾èµ–äº `error.h`ã€`<iostream>`ï¼Œä»¥åŠåœ¨ `<cctype>` é‡Œå£°æ˜çš„é‚£äº›ç”¨äºç¡®å®šå­—ç¬¦ç±»åˆ«çš„å‡½æ•°ï¼š

```javascript
    // lexer.c:
    
    #include "lexer.h"
    #include "error.h"
    #include <iostream>
    #include <cctype>
    
    Lexer::Token_value Lexer::curr_bok;
    double Lexer::number_value;
    std::string Lexer::string_value;
    
    Lexer::Token_value Lexer::get_token(){ /* ... */ }
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å¯¹äº `error.h` çš„#includeæŒ‡ä»¤æå–å‡ºæ¥ï¼Œæ”¾å…¥ä¸€ä¸ªlexerçš„ `_impl.h` æ–‡ä»¶é‡Œã€‚å½“ç„¶ï¼Œæˆ‘è®¤ä¸ºå¯¹è¿™ç§å°ç¨‹åºè€Œè¨€ï¼Œé‚£æ ·åšå®åœ¨å¤ªè¿‡åˆ†äº†ã€‚

&emsp;&emsp;ä¸å¹³å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæ¨¡å—æä¾›çš„ç•Œé¢ï¼ˆåœ¨è¿™é‡Œæ˜¯lexer.hï¼‰ç”¨#includeåŒ…å«åˆ°æ¨¡å—çš„å®ç°ä¸­ï¼Œä»¥ä½¿ç¼–è¯‘å™¨èƒ½åšä¸€è‡´æ€§æ£€æŸ¥ã€‚

&emsp;&emsp;ç¬¦å·è¡¨åŸºæœ¬ä¸Šæ˜¯è‡ªè¶³çš„ï¼Œå› ä¸ºæ ‡å‡†åº“å¤´æ–‡ä»¶ `<map>` èƒ½å¤Ÿå¸¦æ¥ä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰ä¸œè¥¿ï¼Œé‚£é‡Œå®ç°äº†ä¸€ä¸ªæœ‰æ•ˆçš„mapæ¨¡æ¿ç±»ï¼š

```javascript
    // table.h:
    
    #include <map>
    #include <string>
    
    extern std::map<std::string, double> table;
```

ç”±äºæˆ‘ä»¬å‡å®šæ¯ä¸ªå¤´æ–‡ä»¶éƒ½å¯èƒ½é€šè¿‡#includeåŒ…å«åˆ°å‡ ä¸ª `.c` æ–‡ä»¶é‡Œå»ï¼Œæˆ‘ä»¬å¿…é¡»å°†tableçš„å£°æ˜ä¸å…¶å®šä¹‰åˆ†å¼€ï¼Œè™½ç„¶table.cå’Œtable.hçš„å·®åˆ«ä»…åœ¨ä¸€ä¸ªå…³é”®å­—externï¼š

```javascript
    // table.c:
    
    #include "table.h"
    
    std::map<std::string, double> table;
```

ç®€è€Œè¨€ä¹‹ï¼Œé©±åŠ¨ç¨‹åºä¾èµ–äºæ‰€æœ‰çš„ä¸œè¥¿ï¼š

```javascript
    // main.c:
    
    #include "parser.h"
    #include "lexer.h"
    #include "error.h"
    #include "table.h"
    
    namespace Driver {
        int no_of_errors;
        std::istream* input;
        void skip();
    }
    
    #include <sstream>
    int main(int argc, char* argv[]){ /* ... */ }
```

ç”±äºDriveråå­—ç©ºé—´åªæ˜¯ç”±main()ä½¿ç”¨ï¼Œå› æ­¤æˆ‘å°†å®ƒæ”¾åœ¨main.cé‡Œã€‚æˆ‘ä¹Ÿå¯ä»¥æ¢å¦ä¸€ç§æ–¹å¼ï¼Œå°†å®ƒåˆ†å‡ºæ¥åšæˆä¸€ä¸ªdriver.hï¼Œå¹¶ç”¨#includeåŒ…å«è¿›æ¥ã€‚

&emsp;&emsp;å¯¹äºæ›´å¤§çš„ç³»ç»Ÿï¼Œé€šå¸¸å€¼å¾—è€ƒè™‘è¿›ä¸€æ­¥çš„ç»„ç»‡ï¼Œä½¿é©±åŠ¨ç¨‹åºç›´æ¥ä¾èµ–çš„ä¸œè¥¿æ›´å°‘ä¸€äº›ã€‚ä¹Ÿç»å¸¸å€¼å¾—å°†main()æ‰€åšçš„äº‹æƒ…æœ€å°åŒ–ï¼Œè®©main()åªæ˜¯å»è°ƒç”¨ä¸€ä¸ªä½äºå¦ä¸€ä¸ªç‹¬ç«‹æºæ–‡ä»¶é‡Œçš„é©±åŠ¨å‡½æ•°ã€‚å¯¹äºæƒ³ä½œä¸ºåº“å»ä½¿ç”¨çš„ä»£ç ï¼Œè¿™æ ·åšå°±ç‰¹åˆ«é‡è¦ã€‚å› ä¸ºæ­¤åæˆ‘ä»¬å°†ä¸èƒ½ä¾é main()é‡Œçš„ä»£ç ï¼Œè€Œå¿…é¡»ä¸ºæ¥è‡ªå„ç§å„æ ·å‡½æ•°çš„è°ƒç”¨åšå¥½å‡†å¤‡ï¼ˆ9.6[8]ï¼‰ã€‚

ğŸ”š













