##æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ

&emsp;&emsp;å¯¹äºä¸€ä¸ªå‡½æ•°åªèƒ½åšä¸¤ä»¶äº‹ï¼šè°ƒç”¨å®ƒï¼Œæˆ–è€…å–å¾—å®ƒçš„åœ°å€ã€‚é€šè¿‡å–ä¸€ä¸ªå‡½æ•°çš„åœ°å€è€Œå¾—åˆ°çš„æŒ‡é’ˆï¼Œå¯ä»¥åœ¨åé¢ç”¨äºè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œ

```javascript
    void error(string s) { /* ... */ }
    void (*efct)(string);            // æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ
    
    void f()
    {
        efct = &error;               // efctæŒ‡å‘error
        efct("error");               // é€šè¿‡efctè°ƒç”¨error
    }
```

ç¼–è¯‘å™¨çŸ¥é“efctæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¼šå»è°ƒç”¨è¢«æŒ‡çš„å‡½æ•°ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä¸å†™ä»æŒ‡é’ˆå¾—åˆ°å‡½æ•°çš„é—´æ¥è¿ç®— \*ã€‚ä¸æ­¤ç±»ä¼¼ï¼Œå–å¾—å‡½æ•°åœ°å€çš„ & ä¹Ÿå¯ä»¥ä¸å†™ï¼š

```javascript
    void (*f1)(string) = &error;     // ok
    void (*f2)(string) = error;      // ä¹Ÿå¯ä»¥ï¼šä¸&erroræ„æ€ä¸€æ ·
    
    void g()
    {
        f1("Vasa");                  // ok
        (*f1)("Mary Rose");          // ä¹Ÿå¯ä»¥
    }
```

åœ¨æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„å£°æ˜ä¸­ä¹Ÿéœ€è¦ç»™å‡ºå‚æ•°ç±»å‹ï¼Œå°±åƒå‡½æ•°å£°æ˜ä¸€æ ·ã€‚åœ¨æŒ‡é’ˆèµ‹å€¼æ—¶ï¼Œå®Œæ•´çš„å‡½æ•°ç±»å‹å¿…é¡»å®Œå…¨åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œ

```javascript
    void (*pf)(string);               // æŒ‡å‘void(string)
    void f1(string);                  // void(string)
    int f2(string);                   // int(string)
    void f3(int*);                    // void(int*)
    
    void f()
    {
        pf = &f1;                     // ok
        pf = &f2;                     // é”™è¯¯âŒï¼šè¿”å›ç±»å‹ä¸å¯¹
        pf = &f3;                     // é”™è¯¯âŒï¼šå‚æ•°ç±»å‹ä¸å¯¹
        
        pf("Hera");                   // ok
        pf(1);                        // é”™è¯¯âŒï¼šå‚æ•°ç±»å‹ä¸å¯¹
        
        int i = pf("Zeus");           // é”™è¯¯âŒï¼švoidèµ‹å€¼ç»™int
    }
```

æ— è®ºç›´æ¥è°ƒç”¨å‡½æ•°æˆ–é€šè¿‡æŸä¸ªæŒ‡é’ˆå»è°ƒç”¨å‡½æ•°ï¼Œæœ‰å…³å‚æ•°ä¼ é€’çš„è§„åˆ™éƒ½å®Œå…¨ç›¸åŒã€‚

&emsp;&emsp;äººä»¬å¸¸å¸¸ä¸ºäº†æ–¹ä¾¿è€Œä¸ºæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆç±»å‹å®šä¹‰ä¸€ä¸ªåå­—ï¼Œè¿™æ ·å¯ä»¥é¿å…åˆ°å¤„å»å†™æ„ä¹‰ä¸å¤ªæ˜æ˜¾çš„è¯­æ³•å½¢å¼ã€‚ä¸‹é¢æ˜¯æ¥è‡ªUNIXç³»ç»Ÿå¤´æ–‡ä»¶çš„ä¸€ä¸ªä¾‹å­ï¼š

```javascript
    typedef void (*SIG_TYP)(int);        // å–è‡ª<signal.h>
    typedef void (*SIG_ARG_TYP)(int);
    SIG_TYP signal(int, SIG_ARG_TYP);
```

æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„æ•°ç»„å¸¸å¸¸å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘çš„åŸºäºé¼ æ ‡çš„ç¼–è¾‘å™¨é‡Œçš„èœå•ç³»ç»Ÿï¼Œå°±æ˜¯åˆ©ç”¨æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„æ•°ç»„å®ç°çš„ï¼Œè¿™äº›å‡½æ•°è¡¨ç¤ºå„ç§å„æ ·çš„æ“ä½œã€‚è¿™ä¸ªç³»ç»Ÿçš„ç»†èŠ‚ä¸å¯èƒ½åœ¨è¿™é‡Œæè¿°ï¼Œä½†ä¸‹é¢æ˜¯å…¶ä¸­çš„åŸºæœ¬æ€æƒ³ï¼š

```javascript
    typedef void (*PF)();
    PF edit_ops[] = {            // ç¼–è¾‘æ“ä½œ
        &cut, &paste, &copy, &search
    };
    
    PF file_ops[] = {            // æ–‡ä»¶ç®¡ç†
        &open, &append, &close, &write
    };
```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰å¹¶åˆå§‹åŒ–ä¸€äº›æŒ‡é’ˆï¼Œç”±å®ƒä»¬å»æ§åˆ¶å„ç§æ“ä½œï¼Œé€šè¿‡å…³è”äºé¼ æ ‡é”®çš„èœå•å»é€‰æ‹©é‚£äº›æ“ä½œï¼š

```javascript
    PF* button2 = edit_ops;
    PF* button3 = file_ops;
```

åœ¨ä¸€ä¸ªå®Œæ•´çš„å®ç°é‡Œï¼Œå®šä¹‰ä¸€ä¸ªèœå•é¡¹éœ€è¦æä¾›æ›´å¤šçš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¿…é¡»åœ¨æŸä¸ªåœ°æ–¹ä¿å­˜æœ‰å…³éœ€è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²çš„ä¸€ä¸ªæè¿°ã€‚éšç€ç³»ç»Ÿçš„ä½¿ç”¨ï¼Œé¼ æ ‡é”®çš„æ„ä¹‰ä¹Ÿå¯èƒ½éšç¯å¢ƒè€Œé¢‘ç¹å˜åŒ–ï¼Œè¿™ç§å˜åŒ–å°±å¯ä»¥ï¼ˆéƒ¨åˆ†åœ°ï¼‰é€šè¿‡ä¿®æ”¹æŒ‰é”®æ‰€å¯¹åº”çš„æŒ‡é’ˆæ¥å®ç°ã€‚å½“ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªèœå•é¡¹æ—¶ï¼Œä¾‹å¦‚æŒ‰é”®2çš„é¡¹ç›®3ï¼Œå°±ä¼šæ‰§è¡Œç›¸å…³çš„æ“ä½œï¼š

    button2[2]();            // è°ƒç”¨æŒ‰é”®2çš„ç¬¬3ä¸ªå‡½æ•°

è¦ç†è§£æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„è¡¨è¾¾èƒ½åŠ›ï¼Œä¸€ç§æ–¹å¼å°±æ˜¯è¯•ç€å»å†™è¿™ç§ä»£ç è€Œä¸ç”¨å‡½æ•°æŒ‡é’ˆ---ä¹Ÿä¸ç”¨å®ƒä»¬çš„æ›´å…·è‰¯å¥½è¡Œä¸ºçš„å…„å¼Ÿï¼šè™šå‡½æ•°ï¼ˆ12.2.6èŠ‚ï¼‰ã€‚é€šè¿‡æŠŠæ–°å‡½æ•°æ’å…¥è¿ç®—ç¬¦è¡¨ç­‰æ–¹å¼ï¼Œå°±å¯ä»¥åœ¨è¿è¡Œä¸­ä¿®æ”¹è¿™ç§èœå•ã€‚åœ¨è¿è¡Œä¸­æ„é€ å‡ºæ–°èœå•ä¹ŸåŒæ ·éå¸¸å®¹æ˜“ã€‚

&emsp;&emsp;æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå¯ä»¥ç”¨äºæä¾›ä¸€ç§ç®€å•å½¢å¼çš„å¤šæ€æ€§ä¾‹ç¨‹ï¼Œå³é‚£ç§å¯ä»¥åº”ç”¨äºè®¸å¤šä¸åŒç±»å‹çš„å¯¹è±¡çš„ä¾‹ç¨‹ï¼š

```javascript
    typedef int (*CFT)(const void*, const void*);
    void ssort(void* base, size_t n, size_t sz, CFT cmp)
    /*
        å¯¹å‘é‡baseçš„nä¸ªå…ƒç´ æŒ‰ç…§é€’å¢é¡ºåºæ’åºï¼Œ
        ç”¨ç”±"cmp"æ‰€æŒ‡çš„å‡½æ•°åšæ¯”è¾ƒï¼Œ
        å…ƒç´ çš„å¤§å°æ˜¯"sz"ã€‚
        
        Shellæ’åºï¼ˆKnuth, Vol 3, Pg84ï¼‰
    */
    {
         for(int gap = n/2; gap > 0; gap /= 2)
             for(int i = gap; i < n; i++)
                 for(int j = i - gap; j >= 0; j-=gap) {
                     char* b = static_cast<char*>(base);    // å¿…é¡»å¼ºåˆ¶
                     char* pj = b + j * sz;                 // &base[j]
                     char* pjg = b + (j + gap)*sz;          // &base[j+gap]
                     
                     if(cmp(pjg, pj) < 0) {                 // äº¤æ¢base[j]ä¸base[j + gap]:
                         for(int k = 0; k < sz; k++) {
                             char temp = pj[k];
                             pj[k] = pjg[k];
                             pjg[k] = temp;
                         }
                     }
                 }
    }
```

ssort()ä¾‹ç¨‹å¹¶ä¸çŸ¥é“è¢«æ’åºçš„å¯¹è±¡çš„ç±»å‹ï¼Œå®ƒåªçŸ¥é“å…ƒç´ çš„ä¸ªæ•°ï¼ˆæ•°ç»„å¤§å°ï¼‰ï¼Œæ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼Œä»¥åŠåº”è¯¥å»è°ƒç”¨ä»¥å®Œæˆæ¯”è¾ƒçš„å‡½æ•°ã€‚è¿™é‡Œæœ‰æ„å°†ssort()çš„ç±»å‹é€‰çš„ä¸Cæ ‡å‡†åº“æ’åºä¾‹ç¨‹qsort()å®Œå…¨ä¸€æ ·ã€‚å®é™…ç¨‹åºå¯ä»¥ä½¿ç”¨qsort()ï¼ŒC++æ ‡å‡†åº“ç®—æ³•sort(18.7.1èŠ‚)ï¼Œæˆ–è€…å…¶ä»–ç‰¹æ®Šçš„æ’åºä¾‹ç¨‹ã€‚è¿™ç§é£æ ¼çš„ä»£ç åœ¨Cé‡Œå¾ˆå¸¸è§ï¼Œä½†å®ƒä¸æ˜¯åœ¨C++é‡Œè¡¨è¿°è¿™ä¸ªç®—æ³•çš„æœ€ä¼˜ç¾çš„æ–¹å¼ï¼ˆ13.3èŠ‚ã€13.5.2èŠ‚ï¼‰ã€‚

&emsp;&emsp;è¿™ä¸ªæ’åºå‡½æ•°å¯ç”¨äºå¯¹ä¸‹é¢è¿™æ ·çš„è¡¨æ ¼çš„æ’åºï¼š

```javascript
    struct User {
        char* name;
        char* id;
        int dept;
    };
    
    User heads[] = {
        "Ritchie D.M.",    "dmr",    11271,
        "Sethi R.",        "ravi",   11272,
        "Szymanski T.G.",  "tgs",    11273,
        "Schryer N.L.",    "nls",    11274,
        "Schryer N.L.",    "nls",    11275,
        "Kernighan B.W.",  "bwk",    11276
    };
    
    void print_id(User* v, int n)
    {
        for(int i = 0; i < n; i++)
            cout << v[i].name << '\t' << v[i].id << '\t' << v[i].dept << '\n';
    }
```


ä¸ºèƒ½å®Œæˆæ’åºï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªé€‚å½“çš„æ¯”è¾ƒå‡½æ•°ã€‚è¿™ç§æ¯”è¾ƒå‡½æ•°åº”è¯¥åœ¨å…¶ç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°æ—¶è¿”å›è´Ÿå€¼ï¼Œå¦‚æœå®ƒä»¬ç›¸ç­‰å°±è¿”å›0ï¼Œå¦åˆ™å°±è¿”å›æ­£å€¼ï¼š

```javascript
    int cmp1(const void* p, const void* q)    // æ¯”è¾ƒåå­—ä¸²
    {
        return strcmp(static_cast<const User*>(p)->name, static_cast<const User*>(q)->name);
    }

    int cmp2(const void* p, const void* q)    // æ¯”è¾ƒéƒ¨é—¨ç¼–å·
    {
        return static_cast<const User*>(p)->dept - static_cast<const User*>(q)->dept;
    }
```

ä¸‹é¢ç¨‹åºå®Œæˆæ’åºå’Œæ‰“å°ï¼š

```javascript
    int main()
    {
        cout << "Heads in alphabetical order:\n";
        ssort(heads, 6, sizeof(User), cmpl);
        print_id(heads, 6);
        cout << '\n';

        cout << "Heads in order of department number:\n";
        ssort(heads, 6, sizeof(User), cmp2);
        print_id(heads, 6);
    }
```

ä½ å¯ä»¥é€šè¿‡èµ‹å€¼æˆ–è€…åˆå§‹åŒ–æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆçš„æ–¹å¼ï¼Œå–å¾—ä¸€ä¸ªé‡è½½å‡½æ•°çš„åœ°å€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»ä¸€ç»„é‡è½½å‡½æ•°ä¸­é€‰æ‹©çš„å·¥ä½œæ˜¯é€šè¿‡ç›®æ ‡æŒ‡é’ˆçš„ç±»å‹å®ç°çš„ã€‚ä¾‹å¦‚ï¼Œ

```javascript
    void f(int);
    int f(char);

    void (*pf1)(int) = &f;    // void f(int)
    int (*pf2)(char) = &f;    // int f(char)
    void (*pf3)(char) = &f;   // é”™è¯¯âŒï¼šæ²¡æœ‰void f(char)
```

è¦é€šè¿‡æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆè°ƒç”¨çš„å‡½æ•°ï¼Œå…¶å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹éƒ½å¿…é¡»ä¸æŒ‡é’ˆçš„è¦æ±‚å®Œå…¨ä¸€è‡´ï¼Œåœ¨ç”¨å‡½æ•°å¯¹æŒ‡é’ˆèµ‹å€¼æˆ–åˆå§‹åŒ–æ—¶ï¼Œæ²¡æœ‰éšå«çš„å‚æ•°æˆ–è€…è¿”å›å€¼ç±»å‹è½¬æ¢ã€‚è¿™æ„å‘³ç€

    int cmp3(const mytype*, const mytype*);

ä¸æ˜¯ssort()çš„åˆé€‚å‚æ•°ã€‚ç©¶å…¶åŸå› ï¼Œæ¥å—cmp3ä½œä¸ºssortçš„å‚æ•°å°†ä¼šè¿åæœ‰å…³çš„ä¿è¯ï¼šcmp3è°ƒç”¨æ—¶å‚æ•°çš„ç±»å‹æ˜¯mytype*ï¼ˆ9.2.5èŠ‚ï¼‰ã€‚

ğŸ”š















