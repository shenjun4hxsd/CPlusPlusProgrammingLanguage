## å®šä¹‰ç±»å‹çš„æ¨¡å—

åŸºäºæ¨¡å—çš„ç¨‹åºè®¾è®¡è¶‹å‘äºä»¥ä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æ•°æ®ä¸ºä¸­å¿ƒï¼Œåœ¨æŸä¸ªç±»å‹ç®¡ç†æ¨¡å—çš„æ§åˆ¶ä¹‹ä¸‹å·¥ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æœ‰è®¸å¤šå †æ ˆ---è€Œä¸æ˜¯åƒå‰é¢é‚£æ ·åªç”¨ä¸€ä¸ªç”± Stack æ¨¡å—æä¾›çš„å †æ ˆ---æˆ‘ä»¬å°±å¯èƒ½ä¼šå®šä¹‰ä¸€ä¸ªå †æ ˆç®¡ç†å™¨ï¼Œå®ƒå…·æœ‰å¦‚ä¸‹çš„ç•Œé¢ï¼š

```javascript
    namespace Stack
    {
        struct Rep;                // åœ¨å¦å¤–æŸä¸ªåœ°æ–¹å®šä¹‰å †æ ˆçš„å¸ƒå±€
        typedef Rep& stack;

        stack create();            // åšå‡ºä¸€ä¸ªæ–°å †æ ˆ
        void destroy(stack s);     // åˆ é™¤s

        void push(stack s, char c);// å°†cå‹å…¥s
        char pop(stack s);         // å¼¹å‡ºs
    }
```

å£°æ˜

```javascript
    struct Rep;
```

è¯´ `Rep` æ˜¯ä¸€ä¸ªç±»å‹çš„åå­—ï¼Œä½†å°†è¿™ä¸ªç±»å‹ç•™å¾…ä»¥åå†å»å®šä¹‰ã€‚å£°æ˜

```javascript
    typedef Rep& stack;
```

ç¡®å®šåå­— `stack` æ˜¯â€œå¯¹Repçš„å¼•ç”¨â€ã€‚è¿™é‡Œçš„æƒ³æ³•æ˜¯ï¼Œå †æ ˆç”± `Stack::stack` è¡¨ç¤ºï¼Œè€Œè¿›ä¸€æ­¥çš„ç»†èŠ‚åˆ™å¯¹ç”¨æˆ·éšè—èµ·æ¥ã€‚

ä¸€ä¸ª `Stack::stack` ç”¨èµ·æ¥å¾ˆåƒä¸€ä¸ªå†…éƒ¨ç±»å‹çš„å˜é‡ï¼š

```javascript
    struct Bad_pop { };

    void f()
    {
        Stack::stack s1 = Stack::create();    // åšå‡ºä¸€ä¸ªæ–°å †æ ˆ
        Stack::stack s2 = Stack::create();    // åšå‡ºå¦ä¸€ä¸ªæ–°å †æ ˆ

        Stack::push(s1, 'c');
        Stack::push(s2, 'k');

        if(Stack::pop(s1) != 'c') throw Bad_pop();
        if(Stack::pop(s2) != 'k') throw Bad_pop();

        Stack::destroy(s1);
        Stack::destroy(s2);
    }
```

æˆ‘ä»¬å¯ä»¥ä»¥å‡ ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°è¿™ä¸ªå †æ ˆã€‚æœ€é‡è¦çš„æ˜¯ï¼Œç”¨æˆ·å®Œå…¨ä¸å¿…çŸ¥é“æˆ‘ä»¬åˆ°åº•æ˜¯æ€ä¹ˆåšçš„ã€‚åªè¦æˆ‘ä»¬èƒ½ä¿æŒè¿™ä¸ªç•Œé¢ä¸æ”¹å˜ï¼Œå³ä½¿æ˜¯å†³å®šé‡æ–°å®ç° Stackï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šå—åˆ°ä»»ä½•å½±å“ã€‚

æŸä¸ªå®ç°å¯ä»¥æ˜¯é¢„å…ˆåˆ†é…å‡ ä¸ªå †æ ˆï¼Œè€Œè®© `Stack::create()` é€’äº¤å‡ºåˆ°æŸä¸ªå°šæœªä½¿ç”¨çš„å †æ ˆçš„å¼•ç”¨ã€‚è€Œ `Stack::destroy()` åˆ™å°†ä¸€ä¸ªå †æ ˆè¡¨ç¤ºæ ‡è®°ä¸ºæœªä½¿ç”¨çš„ï¼Œä»¥ä½¿ `Stack::create()` èƒ½å¤Ÿé‡æ–°ç”¨å®ƒ

```javascript
    namespace Stack    // è¡¨ç¤º
    {
        const int max_size = 200;

        struct Rep
        {
            char v[max_size];
            int top;
        };

        const int max = 16;    // æœ€å¤§å †æ ˆæ•°
        Rep stacks[max];       // é¢„åˆ†é…çš„å †æ ˆè¡¨ç¤º
        bool used[max];        // å¦‚æœstacks[i]åœ¨ä½¿ç”¨, åˆ™used[i]ä¸ºçœŸ

        typedef Rep& stack;
    }

    void Stack::push(Stack::stack s, char c) { /* æ£€æŸ¥sçš„ä¸Šæº¢å¹¶å‹å…¥c */ }
    char Stack::pop(Stack::stack s) { /* æ£€æŸ¥sçš„ä¸‹æº¢å¹¶å¼¹å‡º */ }
    Stack::stack Stack::create()
    {
        // æ‰¾ä¸€ä¸ªæœªä½¿ç”¨çš„Rep, å°†å®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨çš„ï¼Œå°†å®ƒåˆå§‹åŒ–ï¼Œå¹¶è¿”å›å®ƒçš„å¼•ç”¨
    }
    void Stack::destroy(Stack::stack s) { /* æ ‡è®°sä¸ºæœªä½¿ç”¨çš„ */ }
```

æˆ‘ä»¬åœ¨è¿™é‡Œåšçš„å°±æ˜¯å›´ç»•ç€ä¸€ä¸ªè¡¨ç¤ºç±»å‹åŒ…è£…èµ·ä¸€ç»„ç•Œé¢å‡½æ•°ã€‚æ‰€åšçš„ç»“æœå¾—åˆ°çš„â€œå †æ ˆç±»å‹â€å…·æœ‰æ€æ ·çš„è¡Œä¸ºï¼Œéƒ¨åˆ†åœ¨äºæˆ‘ä»¬å¦‚ä½•å®šä¹‰è¿™äº›ç•Œé¢å‡½æ•°ï¼Œéƒ¨åˆ†åœ¨äºæˆ‘ä»¬å¦‚ä½•å°†Stackçš„è¡¨ç¤ºå±•ç¤ºç»™å®ƒçš„ç”¨æˆ·ï¼Œéƒ¨åˆ†åœ¨äºè¿™ä¸ªè¡¨ç¤ºæœ¬èº«çš„è®¾è®¡æƒ…å†µã€‚

è¿™ç§åšæ³•å¸¸å¸¸ä¸æ˜¯æœ€ç†æƒ³çš„ã€‚ä¸€ä¸ªé‡è¦é—®é¢˜å°±æ˜¯ï¼Œè¿™é‡Œç»™ç”¨æˆ·æä¾›äº†ä¸€ä¸ªâ€œå‡ç±»å‹â€çš„è¡¨ç¤ºï¼Œå®ƒå¯ä»¥å› ä¸ºè¡¨ç¤ºç±»å‹ä¸åŒè€Œå‡ºç°å¾ˆå¤§å˜åŒ–---è€Œä¸æ­¤åŒæ—¶ï¼Œåˆåº”è¯¥å°†ç”¨æˆ·éš”ç¦»äºè¿™ä¸€è¡¨ç¤ºä¹‹å¤–ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨å¦å¤–ä¸€ç§æ›´ç²¾è‡´çš„æ•°æ®ç»“æ„å»è¡¨ç¤ºä¸€ä¸ªå †æ ˆï¼Œé‚£ä¹ˆ`Stack::stack` çš„è¡¨ç¤ºç±»å‹ã€‚

æ›´æ ¹æœ¬çš„é—®é¢˜æ˜¯ï¼Œé€šè¿‡æ¨¡å—å®ç°çš„è¿™ç§ç”¨æˆ·å®šä¹‰ç±»å‹ï¼Œå®ƒä»¬æ‰€æä¾›çš„å¯¹è¿™ç§ç±»å‹çš„è®¿é—®ï¼Œåœ¨è¡Œä¸ºä¸Šï¼Œå¹¶ä¸åƒå†…éƒ¨çš„ç±»å‹ã€‚å®ƒä»¬å¾—åˆ°çš„æ”¯æŒä¹Ÿä¸å†…éƒ¨ç±»å‹ä¸åŒï¼Œè€Œä¸”å®é™…ä¸Šæ›´å°‘ä¸€äº›ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª `Stack::Rep` èƒ½è¢«ä½¿ç”¨çš„æœŸé—´ç”± `Stack::create()` å’Œ `Stack::destroy()` æ§åˆ¶ï¼Œè€Œä¸æ˜¯ç”±æ™®éæ€§çš„è¯­è¨€è§„åˆ™æ§åˆ¶ã€‚


---

```javascript
namespace Stack		// ç•Œé¢
{
	struct Rep;				// å£°æ˜
	typedef Rep& stack;

	stack create();
	void destroy(stack s);

	void push(stack s, char c);
	char pop(stack s);
	void show(stack s);
}

struct Bad_pop{};
struct Bad_push{};

struct Overflow{};

void f()
{
	Stack::stack s1 = Stack::create();
	Stack::stack s2 = Stack::create();

	Stack::push(s1, 'c');
	Stack::push(s2, 'k');

	/*if (Stack::pop(s1) != 'c') throw Bad_pop();
	if (Stack::pop(s2) != 'k') throw Bad_pop();*/

	Stack::push(s1, 'a');
	Stack::push(s1, 'b');

	Stack::push(s2, 'e');
	Stack::push(s2, 'f');
	Stack::push(s2, 'k');

	Stack::pop(s2);

	Stack::show(s1);
	Stack::show(s2);

	Stack::destroy(s1);
	Stack::destroy(s2);
}

namespace Stack		// å®ç°
{
	const int max_size = 200;

	struct Rep		// å®šä¹‰
	{
		char v[max_size];
		int top;
		int index;	// ä¿å­˜å½“å‰å †æ ˆåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•å€¼ï¼Œä»¥ä¾¿æ ¹æ®è¯¥ç´¢å¼•å€¼ destroy
	};

	const int max = 16;			// æœ€å¤§å †æ ˆæ•°
	Rep stacks[max];			// é¢„åˆ†é…çš„å †æ ˆ
	bool used[max];				// å¦‚æœstack[i]åœ¨ä½¿ç”¨ï¼Œåˆ™used[i]ä¸ºtrue
}

void Stack::push(Stack::stack s, char c) 
{
	/* æ£€æŸ¥sçš„ä¸Šæº¢å¹¶å‹å…¥c */
	if (s.top == max_size) throw Bad_push();

	s.v[s.top] = c;
	++s.top;
}

char Stack::pop(Stack::stack s)
{
	/* æ£€æŸ¥sçš„ä¸‹æº¢å¹¶å¼¹å‡º */
	if (s.top == 0) throw Bad_pop();
	--s.top;
	return s.v[s.top];
}

Stack::stack Stack::create()
{
	// æ‰¾åˆ°ä¸€ä¸ªæœªä½¿ç”¨çš„Repï¼Œå°†å®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨çš„ï¼Œå°†å®ƒåˆå§‹åŒ–ï¼Œå¹¶è¿”å›å®ƒçš„å¼•ç”¨
	int index = 0;
	while (Stack::used[index] && index < Stack::max)
	{
		index++;
	}

	if (index == Stack::max) throw Overflow();

	Stack::used[index] = true;		// ä½¿ç”¨è¯¥å †æ ˆï¼Œæ ‡è®°ä¸ºtrue
	Stack::stacks[index].top = 0;
	Stack::stacks[index].index = index;
	return Stack::stacks[index];
}

void Stack::destroy(Stack::stack s)
{
	// æ ‡è®°sä¸ºæœªä½¿ç”¨çš„
	Stack::used[s.index] = false;
}

void Stack::show(Stack::stack s)
{
	for (size_t i = 0; i < s.top; i++)
	{
		printf("%c", s.v[i]);
	}
	printf("\n");
}
```

ğŸ”š

