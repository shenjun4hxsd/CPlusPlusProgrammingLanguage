##ä½¿ç”¨å£°æ˜


&emsp;&emsp;å½“æŸä¸ªåå­—åœ¨å®ƒè‡ªå·±çš„åå­—ç©ºé—´ä¹‹å¤–é¢‘ç¹ä½¿ç”¨æ—¶ï¼Œåœ¨åå¤å†™å®ƒçš„æ—¶å€™éƒ½è¦åŠ ä¸Šæœ‰å…³åå­—ç©ºé—´ä½œä¸ºé™å®šè¯ï¼Œè¿™æ ·åšä¹Ÿä¼šå˜æˆå¾ˆä»¤äººåŒçƒ¦çš„äº‹æƒ…ã€‚è€ƒè™‘

```javascript
    double Parser::prim(bool get)        // å¤„ç†åˆç­‰é¡¹
    {
        if(get) Lexer::get_token();
        
        switch(Lexer::curr_tok) {
        case Lexer::NUMBER:              // æµ®ç‚¹å¸¸é‡
             Lexer::get_token();
             return Lexer::number_value;
        case Lexer::NAME:
        {
            double& v = table[Lexer::string_value];
            if(Lexer::get_token() == Lexer::ASSIGN) v = expr(true);
            return v;
        }
        case Lexer::MINUS:               // ä¸€å…ƒå‡
             return -prim(true);
        case Lexer::LP:
        {
            double e = expr(true);
            if(Lexer::curr_tok != Lexer::RP) return Error::error(") expected");
            Lexer::get_token();          // åƒæ‰ ')'
            return e;
        }
        case Lexer::END:
             return 1;
        default:
             return Error::error("primary expected");
        }
    }
```

åå¤å†™é™å®šè¯Lexerå¾ˆè®¨åŒï¼Œä¹Ÿä¼šåˆ†æ•£äººçš„æ³¨æ„åŠ›ã€‚è¿™ç§å¤šä½™çš„ä¸œè¥¿å¯ä»¥é€šè¿‡ä¸€ä¸ªä½¿ç”¨å£°æ˜è€Œæ¸…é™¤æ‰ï¼Œåªéœ€è¦åœ¨æŸä¸ªåœ°æ–¹è¯´æ˜ï¼Œåœ¨è¿™ä¸ªä½œç”¨åŸŸé‡Œæ‰€ç”¨çš„get_tokenå°±æ˜¯Lexerçš„get_tokenã€‚ä¾‹å¦‚ï¼Œ

```javascript
    double Parser::prim(bool get)        // å¤„ç†åˆç­‰é¡¹
    {
        using Lexer::get_token;       // ä½¿ç”¨Lexerçš„get_token
        using Lexer::curr_tok;        // ä½¿ç”¨Lexerçš„curr_tok
        using Error::error;           // ä½¿ç”¨Errorçš„error
        
        if(get) get_token();
        
        switch(curr_tok) {
        case Lexer::NUMBER:              // æµ®ç‚¹å¸¸é‡
             get_token();
             return Lexer::number_value;
        case Lexer::NAME:
        {
            double& v = table[Lexer::string_value];
            if(get_token() == Lexer::ASSIGN) v = expr(true);
            return v;
        }
        case Lexer::MINUS:               // ä¸€å…ƒå‡
             return -prim(true);
        case Lexer::LP:
        {
            double e = expr(true);
            if(curr_tok != Lexer::RP) return error(") expected");
            get_token();          // åƒæ‰ ')'
            return e;
        }
        case Lexer::END:
             return 1;
        default:
             return error("primary expected");
        }
    }
```

ä½¿ç”¨å£°æ˜å°†å¼•è¿›å±€éƒ¨çš„åŒä¹‰è¯ã€‚

&emsp;&emsp;å°†åŒä¹‰è¯å°½å¯èƒ½åœ°ä¿æŒåœ¨å±€éƒ¨ä¸­ä»¥é¿å…æ··ä¹±ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„æƒ³æ³•ã€‚ç”±äºæ‰€æœ‰åˆ†æå‡½æ•°éƒ½ä½¿ç”¨å·®ä¸å¤šåŒæ ·çš„ä¸€é›†æ¥è‡ªå…¶ä»–æ¨¡å—çš„åå­—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæœ‰å…³çš„ä½¿ç”¨å£°æ˜æ”¾åœ¨Parseråå­—ç©ºé—´çš„å®šä¹‰é‡Œï¼š

```javascript
    namespace Parser {
        double prim(bool);
        double term(bool);
        double expr(bool);
        
        using Lexer::get_token;        // ä½¿ç”¨Lexerçš„get_token
        using Lexer::curr_tok;         // ä½¿ç”¨Lexerçš„curr_tok
        using Error::error;            // ä½¿ç”¨Errorçš„error
    }
```

è¿™å°±ä½¿æˆ‘ä»¬èƒ½å°†Parserå‡½æ•°ç®€åŒ–åˆ°å‡ ä¹ç­‰åŒäºåŸæ¥çš„ç‰ˆæœ¬äº†ï¼š

```javascript
    double Parser::term(bool get)        // ä¹˜å’Œé™¤
    {
        double left = prim(get);
        
        for(;;)
            switch(curr_tok) {
            case Lexer::MUL:
                left *= prim(true);
                break;
            case Lexer::DIV:
                if(double d = prim(true)) {
                    left /= d;
                    break;
                }
                return error("divide by 0");
            default:
                return left;
            }
    }
```

ä¹Ÿå¯ä»¥å°†å„ä¸ªå•è¯çš„åå­—å¼•è¿›Parseråå­—ç©ºé—´ã€‚ç„¶è€Œæˆ‘è¿˜æ˜¯é‡‡ç”¨å¸¦æ˜¾å¼é™å®šè¯çš„å½¢å¼æŠŠå®ƒä»¬æ”¾åœ¨é‚£é‡Œï¼Œä»¥å¸®åŠ©æˆ‘ä»¬è®°ä½Parserä¾èµ–äºLexerã€‚


ğŸ”š



